/*
 * This file is part of Adblock Plus <https://adblockplus.org/>,
 * Copyright (C) 2006-present eyeo GmbH
 *
 * Adblock Plus is free software: you can redistribute it and/or modify
 * it under the terms of the GNU General Public License version 3 as
 * published by the Free Software Foundation.
 *
 * Adblock Plus is distributed in the hope that it will be useful,
 * but WITHOUT ANY WARRANTY; without even the implied warranty of
 * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
 * GNU General Public License for more details.
 *
 * You should have received a copy of the GNU General Public License
 * along with Adblock Plus.  If not, see <http://www.gnu.org/licenses/>.
 */
"use strict";let ABP=getABPNamespace();let{Object:Object,utils:utils,DOM:DOM}=ABP;let{getComputedStyle:getComputedStyle,setInterval:setInterval,setTimeout:setTimeout,performance:performance,fetch:fetch,getWindowFrames:getWindowFrames,getOnerror:getOnerror,setOnerror:setOnerror}=ABP.window;let fetchContentMap=new Map;let dependencyGraph=new Map;let injectionCode=[];let injectionDependencies=new Set;exports.prepareInjection=()=>{injectionCode.splice(0);injectionDependencies.clear()};exports.commitInjection=()=>{if(injectionCode.length<1)return;let e=injectionCode.splice(0);let t=[...injectionDependencies];injectionDependencies.clear();let r=`\n    (function()\n    {\n      "use strict";\n\n      let secured = (Class) =>\n      {\n        class Secured extends Class {};\n        let a = Class.prototype;\n        let b = Secured.prototype;\n        for (let key of Reflect.ownKeys(a))\n        {\n          let desc = window.Object.getOwnPropertyDescriptor(a, key);\n          desc.configurable = false;\n          if (desc.writable)\n            desc.writable = false;\n          window.Object.defineProperty(b, key, desc);\n        }\n        return Secured;\n      };\n\n      let MutationObserver = secured(window.MutationObserver);\n      let DOMParser = secured(window.DOMParser);\n      let Set = secured(window.Set);\n      let Array = secured(window.Array);\n      let RegExp = secured(window.RegExp);\n      let ReferenceError = secured(window.ReferenceError);\n      let Error = secured(window.Error);\n      let URL = secured(window.URL);\n      \n      let environment = ${JSON.stringify(environment)};\n      let ABP = (${getABPNamespace})();\n      let {Object, utils, DOM} = ABP;\n      let {getComputedStyle, setInterval, setTimeout, performance, fetch,\n           getWindowFrames, getOnerror, setOnerror} = ABP.window;\n      let debug = ${debug};\n      let inactiveProfile = ${inactiveProfile};\n      let noopProfile = ${noopProfile};\n      ${t.join("\n")}\n      ${e.join("\n")}\n    })();\n  `;let n=document.createElement("script");n.type="application/javascript";n.async=false;if(typeof netscape!="undefined"&&typeof browser!="undefined"){let e=URL.createObjectURL(new Blob([r]));n.src=e;document.documentElement.appendChild(n);URL.revokeObjectURL(e)}else{n.textContent=r;document.documentElement.appendChild(n)}document.documentElement.removeChild(n)};function getABPNamespace(){let{Object:e}=window;let{assign:t,defineProperty:r,freeze:n,getOwnPropertyDescriptor:o,values:i}=window.Object;let{getComputedStyle:l,setInterval:a,setTimeout:s,performance:c}=window;let p=(e,t=[])=>{let i=new e(...t);for(let t of Reflect.ownKeys(e.prototype))r(i,t,o(e.prototype,t));return n(i)};let u=e=>Function.call.bind(e);return n({Object:n({assign:t.bind(e),defineProperty:r.bind(e),getOwnPropertyDescriptor:o.bind(e),values:(i||function(e){return this.keys(e).map((t=>e[t]))}).bind(e),self:e}),utils:n({Math:{floor:Math.floor.bind(Math),random:Math.random.bind(Math)},parseFloat:parseFloat.bind(window),isOwnProperty:u(e.prototype.hasOwnProperty),String:{replace:u(String.prototype.replace),substring:u(String.prototype.substring),indexOf:u(String.prototype.indexOf),slice:u(String.prototype.slice),includes:u(String.prototype.includes),split:u(String.prototype.split)},CSSStyleDeclaration:{setProperty:u(CSSStyleDeclaration.prototype.setProperty),getPropertyValue:u(CSSStyleDeclaration.prototype.getPropertyValue),getPropertyPriority:u(CSSStyleDeclaration.prototype.getPropertyPriority)},Array:{push:u(Array.prototype.push),unshift:u(Array.prototype.unshift),pop:u(Array.prototype.pop),some:u(Array.prototype.some),filter:u(Array.prototype.filter),map:u(Array.prototype.map),join:u(Array.prototype.join)},Function:{apply:u(Function.prototype.apply),call:u(Function.prototype.call),bind:u(Function.prototype.bind)},Number:{toString:u(Number.prototype.toString)},console:{log:console.log.bind(console),dir:console.dir.bind(console),groupCollapsed:console.groupCollapsed.bind(console),groupEnd:console.groupEnd.bind(console)},JSON:{parse:JSON.parse.bind(JSON),self:JSON},MutationRecord:{getAddedNodes:u(o(window.MutationRecord.prototype,"addedNodes").get)},Node:{ELEMENT_NODE:Node.ELEMENT_NODE,TEXT_NODE:Node.TEXT_NODE,prototype:Node.prototype},Element:{prototype:Element.prototype},HTMLElement:{prototype:HTMLElement.prototype},RegExp:{test:u(RegExp.prototype.test)},URLSearchParams:{delete:u(URLSearchParams.prototype.delete)}}),window:n({getComputedStyle:l.bind(window),setInterval:a.bind(window),setTimeout:s.bind(window),performance:c,fetch:window.fetch,getWindowFrames:o(window,"frames")&&o(window,"frames").get?o(window,"frames").get.bind(window):()=>window.frames,getOnerror:o(window,"onerror")&&o(window,"onerror").get?o(window,"onerror").get.bind(window):()=>window.onerror,setOnerror:o(window,"onerror")&&o(window,"onerror").set?o(window,"onerror").set.bind(window):e=>{window.onerror=e}}),DOM:n({getParentNode:u(o(Node.prototype,"parentNode").get),getTextContent:u(o(Node.prototype,"textContent").get),getSrc:u(o(HTMLScriptElement.prototype,"src").get),getNodeType:u(o(Node.prototype,"nodeType").get),getChildNodes:u(o(Node.prototype,"childNodes").get),getOuterHTML:u(o(Element.prototype,"outerHTML").get),getBody:o(Document.prototype,"body")?u(o(Document.prototype,"body").get):e=>e.body,getCurrentScript:o(Document.prototype,"currentScript")?u(o(Document.prototype,"currentScript").get):e=>e.currentScript,document:n({$$:document.querySelectorAll.bind(document)}),matches:u(Element.prototype.matches),attachShadow:u(Element.prototype.attachShadow),closest:u(Element.prototype.closest),frozen:p(WeakMap),shadows:p(WeakMap),hidden:p(WeakSet),iframePropertiesToAbort:{read:p(Set),write:p(Set)},abortedIframes:p(WeakMap)})})}function registerDependencies(e,...t){if(dependencyGraph.has(e))throw new Error(`duplicated ${e.name} dependencies`);dependencyGraph.set(e,t)}function resolveDependencies(e){injectionDependencies.add(e);for(let t of dependencyGraph.get(e)||[]){if(!injectionDependencies.has(t)){injectionDependencies.add(t);resolveDependencies(t)}}}function fetchContent(e,{as:t="arrayBuffer",cleanup:r=6e4}={}){let n=t+":"+e;let o=fetchContentMap.get(n)||{remove:()=>fetchContentMap.delete(n),result:null,timer:0};clearTimeout(o.timer);o.timer=setTimeout(o.remove,r);if(!o.result){o.result=fetch(e).then((e=>e[t]()));o.result.catch(o.remove);fetchContentMap.set(n,o)}return o.result}function regexEscape(e){return utils.String.replace(e,/[-/\\^$*+?.()|[\]{}]/g,"\\$&")}function toRegExp(e){if(e.length>=2&&e[0]=="/"&&e[e.length-1]=="/")return new RegExp(utils.String.substring(e,1,e.length-1));return new RegExp(regexEscape(e))}registerDependencies(toRegExp,regexEscape);function toHex(e,t=2){let r=e.toString(16);if(r.length<t)r="0".repeat(t-r.length)+r;return r}function uint8ArrayToHex(e){return e.reduce(((e,t)=>e+toHex(t)),"")}function getComputedCSSText(e){let t=getComputedStyle(e);let{cssText:r}=t;if(r)return r;for(let e of t)r+=`${e}: ${t[e]}; `;return r.trim()}function stringifyFunctionCall(e,...t){return`${e.name}(${t.map(JSON.stringify).join(",")});`}function makeInjector(e){return(...t)=>{resolveDependencies(e);injectionCode.push(stringifyFunctionCall(e,...t))}}function hideElement(e){if(ABP.DOM.hidden.has(e))return;ABP.DOM.hidden.add(e);let{style:t}=e;let r=[];for(let[e,n]of environment.debugCSSProperties||[["display","none"]]){utils.CSSStyleDeclaration.setProperty(t,e,n,"important");let o=utils.CSSStyleDeclaration.getPropertyValue(t,e);utils.Array.push(r,[e,o])}new MutationObserver((()=>{for(let[e,n]of r){let r=utils.CSSStyleDeclaration.getPropertyValue(t,e);let o=utils.CSSStyleDeclaration.getPropertyPriority(t,e);if(r!=n||o!="important")utils.CSSStyleDeclaration.setProperty(t,e,n,"important")}})).observe(e,{attributes:true,attributeFilter:["style"]})}function log(...e){let{mark:t,end:r}=profile("log");if(debug)utils.Array.unshift(e,"%c DEBUG","font-weight: bold");t();utils.console.log(...e);r()}registerDependencies(log,profile);exports.log=log;function trace(...e){log(...e)}registerDependencies(trace,log);exports.trace=makeInjector(trace);function hideIfShadowContains(e,t="*"){let r=utils.Element.prototype.attachShadow;if(!r)return;let n=toRegExp(e);let o=DOM.shadows;function i(e,r){let{host:i,root:l}=o.get(r)||{};if(!i||!l)return;if(n.test(DOM.getTextContent(l))){let e=DOM.closest(i,t);if(e)hideElement(e)}}Object.defineProperty(utils.Element.prototype,"attachShadow",{value(...e){let t=utils.Function.apply(r,this,e);let n=new MutationObserver(i);n.observe(t,{childList:true,characterData:true,subtree:true});o.set(n,{host:this,root:t});return t}})}registerDependencies(hideIfShadowContains,toRegExp,hideElement);exports["hide-if-shadow-contains"]=makeInjector(hideIfShadowContains);function hideIfMatches(e,t,r){if(r==null)r=t;let n=()=>{for(let n of document.querySelectorAll(r)){let r=n.closest(t);if(r&&e(n,r))hideElement(r)}};new MutationObserver(n).observe(document,{childList:true,characterData:true,subtree:true});n()}function hideIfContains(e,t="*",r=null){let n=toRegExp(e);hideIfMatches((e=>n.test(e.textContent)),t,r)}exports["hide-if-contains"]=hideIfContains;function isVisible(e,t,r){if(t.getPropertyValue("display")=="none")return false;let n=t.getPropertyValue("visibility");if(n=="hidden"||n=="collapse")return false;if(!r||e==r)return true;let o=e.parentElement;if(!o)return true;return isVisible(o,getComputedStyle(o),r)}function hideIfContainsVisibleText(e,t,r=null){function n(e,t){if(!t)t=getComputedStyle(e);if(t.getPropertyValue("opacity")=="0")return false;if(t.getPropertyValue("font-size")=="0px")return false;let r=t.getPropertyValue("color");if(r=="rgba(0, 0, 0, 0)")return false;if(t.getPropertyValue("background-color")==r)return false;return true}function o(e,t){let r=getComputedStyle(e,t);if(!isVisible(e,r)||!n(e,r))return"";let{content:o}=r;if(o&&o!=="none"){let t=[];o=o.trim().replace(/(["'])(?:(?=(\\?))\2.)*?\1/g,(e=>`${t.push(e.slice(1,-1))-1}`));o=o.replace(/\s*attr\(\s*([^\s,)]+)[^)]*?\)\s*/g,((t,r)=>e.getAttribute(r)||""));return o.replace(/\x01(\d+)/g,((e,r)=>t[r]))}return""}function i(e,t,r){let l=!r;if(l)r=getComputedStyle(e);if(!isVisible(e,r,l&&t))return"";let a=o(e,":before");for(let t of e.childNodes){switch(t.nodeType){case Node.ELEMENT_NODE:a+=i(t,e,getComputedStyle(t));break;case Node.TEXT_NODE:if(n(e,r))a+=t.nodeValue;break}}return a+o(e,":after")}let l=toRegExp(e);let a=new WeakSet;hideIfMatches(((e,t)=>{if(a.has(e))return false;a.add(e);let r=i(e,t);let n=l.test(r);if(debug&&r.length)log(n,l,r);return n}),t,r)}exports["hide-if-contains-visible-text"]=hideIfContainsVisibleText;function hideIfContainsAndMatchesStyle(e,t="*",r=null,n=null,o=null){if(r==null)r=t;let i=toRegExp(e);let l=n?toRegExp(n):null;let a=o?toRegExp(o):null;new MutationObserver((()=>{for(let e of document.querySelectorAll(r)){if(i.test(e.textContent)&&(!a||a.test(getComputedCSSText(e)))){let r=e.closest(t);if(r&&(!l||l.test(getComputedCSSText(r))))hideElement(r)}}})).observe(document,{childList:true,characterData:true,subtree:true})}exports["hide-if-contains-and-matches-style"]=hideIfContainsAndMatchesStyle;function hideIfHasAndMatchesStyle(e,t="*",r=null,n=null,o=null){if(r==null)r=t;let i=n?toRegExp(n):null;let l=o?toRegExp(o):null;new MutationObserver((()=>{for(let n of document.querySelectorAll(r)){if(n.querySelector(e)&&(!l||l.test(getComputedCSSText(n)))){let e=n.closest(t);if(e&&(!i||i.test(getComputedCSSText(e))))hideElement(e)}}})).observe(document,{childList:true,subtree:true})}exports["hide-if-has-and-matches-style"]=hideIfHasAndMatchesStyle;function hideIfContainsImage(e,t,r){if(r==null)r=t;let n=toRegExp(e);new MutationObserver((()=>{for(let e of document.querySelectorAll(r)){let r=getComputedStyle(e);let o=r["background-image"].match(/^url\("(.*)"\)$/);if(o){fetchContent(o[1]).then((r=>{if(n.test(uint8ArrayToHex(new Uint8Array(r)))){let r=e.closest(t);if(r)hideElement(r)}}))}}})).observe(document,{childList:true,subtree:true})}exports["hide-if-contains-image"]=hideIfContainsImage;function dirString(e="1"){let{dir:t}=utils.console;console.dir=function(r){for(let t=0;t<e;t++)r+"";if(typeof t=="function")utils.Function.call(t,this,r)}}exports["dir-string"]=makeInjector(dirString);function randomId(){return utils.Number.toString(utils.Math.floor(utils.Math.random()*2116316160+60466176),36)}function wrapPropertyAccess(e,t,r){let n=utils.String.indexOf(t,".");if(n==-1){let n=Object.getOwnPropertyDescriptor(e,t);if(n&&!n.configurable)return;let o=Object.assign({},r,{configurable:true});if(!n&&!o.get&&o.set){let r=e[t];o.get=()=>r}Object.defineProperty(e,t,o);return}let o=utils.String.slice(t,0,n);t=utils.String.slice(t,n+1);let i=e[o];if(i&&(typeof i=="object"||typeof i=="function"))wrapPropertyAccess(i,t,r);let l=Object.getOwnPropertyDescriptor(e,o);if(l&&!l.configurable)return;let a=e=>{i=e;if(e&&(typeof e=="object"||typeof i=="function"))wrapPropertyAccess(e,t,r)};Object.defineProperty(e,o,{get:()=>i,set:a,configurable:true})}function overrideOnError(e){let t=getOnerror();setOnerror(((r,...n)=>{if(typeof r=="string"&&utils.String.includes(r,e))return true;if(typeof t=="function")return utils.Function.call(t,this,r,...n)}))}function abortOnPropertyRead(e){abortOnRead("abort-on-property-read",window,e)}registerDependencies(abortOnPropertyRead,abortOnRead);exports["abort-on-property-read"]=makeInjector(abortOnPropertyRead);function abortOnRead(e,t,r){let n=utils.Function.bind(debug?log:()=>{},null,e);if(!r){n("no property to abort on read");return}let o=randomId();function i(){n(`${r} access aborted`);throw new ReferenceError(o)}n(`aborting on ${r} access`);wrapPropertyAccess(t,r,{get:i,set(){}});overrideOnError(o)}registerDependencies(abortOnRead,log,overrideOnError,randomId,wrapPropertyAccess);function abortOnPropertyWrite(e){abortOnWrite("abort-on-property-write",window,e)}registerDependencies(abortOnPropertyWrite,abortOnWrite);exports["abort-on-property-write"]=makeInjector(abortOnPropertyWrite);function abortOnWrite(e,t,r){let n=utils.Function.bind(debug?log:()=>{},null,e);if(!r){n("no property to abort on write");return}let o=randomId();function i(){n(`setting ${r} aborted`);throw new ReferenceError(o)}n(`aborting when setting ${r}`);wrapPropertyAccess(t,r,{set:i});overrideOnError(o)}registerDependencies(abortOnWrite,log,overrideOnError,randomId,wrapPropertyAccess);function abortCurrentInlineScript(e,t=null){let r=t?toRegExp(t):null;let n=randomId();let o=DOM.getCurrentScript(document);let i=window;let l=utils.String.split(e,".");let a=utils.Array.pop(l);for(let e of l){i=i[e];if(!i||!(typeof i=="object"||typeof i=="function"))return}let{get:s,set:c}=Object.getOwnPropertyDescriptor(i,a)||{};let p=i[a];let u=()=>{let e=DOM.getCurrentScript(document);if(DOM.getSrc(e)==""&&e!=o&&(!r||r.test(DOM.getTextContent(e))))throw new ReferenceError(n)};let d={get(){u();if(s)return utils.Function.call(s,this);return p},set(e){u();if(c)utils.Function.call(c,this,e);else p=e}};wrapPropertyAccess(i,a,d);overrideOnError(n)}registerDependencies(abortCurrentInlineScript,overrideOnError,randomId,toRegExp,wrapPropertyAccess);exports["abort-current-inline-script"]=makeInjector(abortCurrentInlineScript);function jsonPrune(e,t=""){if(!e)throw new Error("Missing paths to prune");let r=utils.String.split(e,/ +/);let n=t!==""?utils.String.split(t,/ +/):[];let o=utils.JSON.parse;let i={value(...e){let t;t=utils.Function.apply(o,this,e);if(n.length>0&&utils.Array.some(n,(e=>!l(t,e))))return t;for(let e of r){let r=l(t,e);if(typeof r!="undefined")delete r[0][r[1]]}return t}};Object.defineProperty(utils.JSON.self,"parse",i);function l(e,t){if(!(e instanceof Object.self))return;let r=e;let n=utils.String.split(t,".");if(n.length===0)return;for(let e=0;e<n.length-1;e++){let t=n[e];if(!utils.isOwnProperty(r,t))return;r=r[t];if(!(r instanceof Object.self))return}let o=n[n.length-1];if(utils.isOwnProperty(r,o))return[r,o]}}exports["json-prune"]=makeInjector(jsonPrune);function freezeElement(e,t="",...r){let n;let o=false;let i=false;let l=utils.Array.filter(r,(e=>!u(e)));let a=utils.Array.map(utils.Array.filter(r,u),toRegExp);let s=randomId();let c;d();let p={selector:e,shouldAbort:i,rid:s,exceptionSelectors:l,regexExceptions:a,changeId:0};if(!ABP.DOM.frozen.has(document)){ABP.DOM.frozen.set(document,true);f()}n=new MutationObserver(g);n.observe(document,{childList:true,subtree:true});g();function u(e){return e.length>=2&&e[0]=="/"&&e[e.length-1]=="/"}function d(){let r=utils.String.split(t,"+");if(r.length===1&&r[0]==="")r=[];for(let t of r){switch(t){case"subtree":o=true;break;case"abort":i=true;break;default:throw new Error("[freeze] Unknown option passed to the snippet."+" [selector]: "+e+" [option]: "+t)}}}function f(){let e;let t={prototype:utils.Node.prototype};let r={prototype:utils.Element.prototype};let n={prototype:utils.HTMLElement.prototype};e=A(t.prototype,"appendChild",o,a);wrapPropertyAccess(t.prototype,"appendChild",e);e=A(t.prototype,"insertBefore",o,a);wrapPropertyAccess(t.prototype,"insertBefore",e);e=A(t.prototype,"replaceChild",o,a);wrapPropertyAccess(t.prototype,"replaceChild",e);e=S(r.prototype,"append",o,a);wrapPropertyAccess(r.prototype,"append",e);e=S(r.prototype,"prepend",o,a);wrapPropertyAccess(r.prototype,"prepend",e);e=S(r.prototype,"replaceWith",i,s);wrapPropertyAccess(r.prototype,"replaceWith",e);e=S(r.prototype,"after",i,s);wrapPropertyAccess(r.prototype,"after",e);e=S(r.prototype,"before",i,s);wrapPropertyAccess(r.prototype,"before",e);e=D(r.prototype,"insertAdjacentElement",l,c);wrapPropertyAccess(r.prototype,"insertAdjacentElement",e);e=D(r.prototype,"insertAdjacentHTML",l,c);wrapPropertyAccess(r.prototype,"insertAdjacentHTML",e);e=D(r.prototype,"insertAdjacentText",l,c);wrapPropertyAccess(r.prototype,"insertAdjacentText",e);e=x(r.prototype,"innerHTML",o,a);wrapPropertyAccess(r.prototype,"innerHTML",e);e=x(r.prototype,"outerHTML",i,s);wrapPropertyAccess(r.prototype,"outerHTML",e);e=C(t.prototype,"textContent",o,a);wrapPropertyAccess(t.prototype,"textContent",e);e=C(n.prototype,"innerText",o,a);wrapPropertyAccess(n.prototype,"innerText",e);e=C(t.prototype,"nodeValue",o,a);wrapPropertyAccess(t.prototype,"nodeValue",e);function o(e){return e&&ABP.DOM.frozen.has(e)}function i(e){try{return e&&(ABP.DOM.frozen.has(e)||ABP.DOM.frozen.has(DOM.getParentNode(e)))}catch(e){return false}}function l(e,t){try{return e&&(ABP.DOM.frozen.has(e)&&t||ABP.DOM.frozen.has(DOM.getParentNode(e))&&!t)}catch(e){return false}}function a(e){return ABP.DOM.frozen.get(e)}function s(e){try{if(ABP.DOM.frozen.has(e))return ABP.DOM.frozen.get(e);let t=DOM.getParentNode(e);return ABP.DOM.frozen.get(t)}catch(e){}}function c(e,t){try{if(ABP.DOM.frozen.has(e)&&t)return ABP.DOM.frozen.get(e);let r=DOM.getParentNode(e);return ABP.DOM.frozen.get(r)}catch(e){}}}function g(){c=ABP.DOM.document.$$(e);h(c,false)}function h(e,t=true){for(let r of e){if(!ABP.DOM.frozen.has(r)){ABP.DOM.frozen.set(r,p);if(!t&&o){new MutationObserver((e=>{for(let t of e)h(utils.MutationRecord.getAddedNodes(t))})).observe(r,{childList:true,subtree:true})}if(o&&DOM.getNodeType(r)===utils.Node.ELEMENT_NODE)h(DOM.getChildNodes(r))}}}function y(e,...t){log(`[freeze][${e}] `,...t)}function m(e,t,r,n){let o=n.selector;let i=n.changeId;let l=typeof e=="string";let a=n.shouldAbort?"aborting":"watching";utils.console.groupCollapsed(`[freeze][${i}] ${a}: ${o}`);switch(r){case"appendChild":case"append":case"prepend":case"insertBefore":case"replaceChild":case"insertAdjacentElement":case"insertAdjacentHTML":case"insertAdjacentText":case"innerHTML":case"outerHTML":y(i,l?"text: ":"node: ",e);y(i,"added to node: ",t);break;case"replaceWith":case"after":case"before":y(i,l?"text: ":"node: ",e);y(i,"added to node: ",DOM.getParentNode(t));break;case"textContent":case"innerText":case"nodeValue":y(i,"content of node: ",t);y(i,"changed to: ",e);break;default:break}y(i,`using the function "${r}"`);utils.console.groupEnd();n.changeId++}function b(e,t){if(t){for(let r of t){if(ABP.DOM.matches(e,r))return true}}return false}function w(e,t){if(t){for(let r of t){if(r.test(e))return true}}return false}function O(e){throw new ReferenceError(e)}function P(e,t,r,n){let o="";let i=new DOMParser;let l=i.parseFromString(e,"text/html");let a=DOM.getChildNodes(DOM.getBody(l));let s=E(a,t,r,n);let c=utils.Array.map(s,(e=>{switch(DOM.getNodeType(e)){case utils.Node.ELEMENT_NODE:return DOM.getOuterHTML(e);case utils.Node.TEXT_NODE:return DOM.textContent(e);default:return""}}));o=utils.Array.join(c,"");return o}function E(e,t,r,n){let o=[];for(let i of e){if(M(i,t,r,n))utils.Array.push(o,i)}return o}function M(e,t,r,n){let o=n.shouldAbort;let i=n.regexExceptions;let l=n.exceptionSelectors;let a=n.rid;if(typeof e=="string"){let l=e;if(w(l,i))return true;if(debug)m(l,t,r,n);if(o)O(a);return debug}let s=e;switch(DOM.getNodeType(s)){case utils.Node.ELEMENT_NODE:if(b(s,l))return true;if(o){if(debug)m(s,t,r,n);O(a)}if(debug){hideElement(s);m(s,t,r,n);return true}return false;case utils.Node.TEXT_NODE:if(w(DOM.getTextContent(s),i))return true;if(debug)m(s,t,r,n);if(o)O(a);return false;default:return true}}function A(e,t,r,n){let o=Object.getOwnPropertyDescriptor(e,t)||{};let i=o.get&&utils.Function.call(o.get,e)||o.value;if(!i)return;return{get(){return function(...e){if(r(this)){let r=n(this);if(r){let n=e[0];if(!M(n,this,t,r))return n}}return utils.Function.apply(i,this,e)}}}}function S(e,t,r,n){let o=Object.getOwnPropertyDescriptor(e,t)||{};let i=o.get&&utils.Function.call(o.get,e)||o.value;if(!i)return;return{get(){return function(...e){if(!r(this))return utils.Function.apply(i,this,e);let o=n(this);if(!o)return utils.Function.apply(i,this,e);let l=E(e,this,t,o);if(l.length>0)return utils.Function.apply(i,this,l)}}}}function D(e,t,r,n){let o=Object.getOwnPropertyDescriptor(e,t)||{};let i=o.get&&utils.Function.call(o.get,e)||o.value;if(!i)return;return{get(){return function(...e){let[o,l]=e;let a=o==="afterbegin"||o==="beforeend";if(r(this,a)){let e=n(this,a);if(e){let r=a?this:DOM.getParentNode(this);let n;switch(t){case"insertAdjacentElement":if(!M(l,r,t,e))return l;break;case"insertAdjacentHTML":n=P(l,r,t,e);if(n){return utils.Function.call(i,this,o,n)}return;case"insertAdjacentText":if(!M(l,r,t,e))return;break;default:break}}}return utils.Function.apply(i,this,e)}}}}function x(e,t,r,n){let o=Object.getOwnPropertyDescriptor(e,t)||{};let{set:i}=o;if(!i)return;return{set(e){if(!r(this))return utils.Function.call(i,this,e);let o=n(this);if(!o)return utils.Function.call(i,this,e);let l=P(e,this,t,o);if(l)return utils.Function.call(i,this,l)}}}function C(e,t,r,n){let o=Object.getOwnPropertyDescriptor(e,t)||{};let{set:i}=o;if(!i)return;return{set(e){if(!r(this))return utils.Function.call(i,this,e);let o=n(this);if(!o)return utils.Function.call(i,this,e);if(M(e,this,t,o))return utils.Function.call(i,this,e)}}}}registerDependencies(freezeElement,hideElement,randomId,toRegExp,log,wrapPropertyAccess);exports["freeze-element"]=makeInjector(freezeElement);function overridePropertyRead(e,t){if(!e){throw new Error("[override-property-read snippet]: "+"No property to override.")}if(typeof t==="undefined"){throw new Error("[override-property-read snippet]: "+"No value to override with.")}let r;let n=utils.Function.bind(debug?log:()=>{},null,"override-property-read");if(t==="false"){r=false}else if(t==="true"){r=true}else if(t==="null"){r=null}else if(t==="noopFunc"){r=()=>{}}else if(t==="trueFunc"){r=()=>true}else if(t==="falseFunc"){r=()=>false}else if(utils.RegExp.test(/^\d+$/,t)){r=utils.parseFloat(t)}else if(t===""){r=t}else if(t!=="undefined"){throw new Error("[override-property-read snippet]: "+`Value "${t}" is not valid.`)}let o=()=>{n(`${e} override done.`);return r};n(`Overriding ${e}.`);wrapPropertyAccess(window,e,{get:o,set(){}})}registerDependencies(overridePropertyRead,log,wrapPropertyAccess);exports["override-property-read"]=makeInjector(overridePropertyRead);function abortOnIframePropertyRead(...e){abortOnIframe(e,true,false)}registerDependencies(abortOnIframePropertyRead,abortOnIframe);exports["abort-on-iframe-property-read"]=makeInjector(abortOnIframePropertyRead);function abortOnIframePropertyWrite(...e){abortOnIframe(e,false,true)}registerDependencies(abortOnIframePropertyWrite,abortOnIframe);exports["abort-on-iframe-property-write"]=makeInjector(abortOnIframePropertyWrite);function abortOnIframe(e,t=false,r=false){let n=ABP.DOM.abortedIframes;let o=ABP.DOM.iframePropertiesToAbort;for(let o of Array.from(getWindowFrames())){if(n.has(o)){for(let i of e){if(t)n.get(o).read.add(i);if(r)n.get(o).write.add(i)}}}for(let n of e){if(t)o.read.add(n);if(r)o.write.add(n)}i();if(!n.has(document)){n.set(document,true);addHooksOnDomAdditions(i)}function i(){for(let e of Array.from(getWindowFrames())){if(!n.has(e)){n.set(e,{read:new Set(o.read),write:new Set(o.write)})}let t=n.get(e).read;if(t.size>0){let r=Array.from(t);t.clear();for(let t of r)abortOnRead("abort-on-iframe-property-read",e,t)}let r=n.get(e).write;if(r.size>0){let t=Array.from(r);r.clear();for(let r of t)abortOnWrite("abort-on-iframe-property-write",e,r)}}}}registerDependencies(abortOnIframe,randomId,addHooksOnDomAdditions,abortOnRead,abortOnWrite);function addHooksOnDomAdditions(e){let t;let r={prototype:utils.Node.prototype};let n={prototype:utils.Element.prototype};o(r.prototype,["appendChild","insertBefore","replaceChild"]);o(n.prototype,["append","prepend","replaceWith","after","before","insertAdjacentElement","insertAdjacentHTML"]);t=l(n.prototype,"innerHTML");wrapPropertyAccess(n.prototype,"innerHTML",t);t=l(n.prototype,"outerHTML");wrapPropertyAccess(n.prototype,"outerHTML",t);function o(e,t){for(let r of t){let t=i(e,r);wrapPropertyAccess(e,r,t)}}function i(t,r){let n=t[r];return{get(){return function(...t){let r;r=utils.Function.apply(n,this,t);e&&e();return r}}}}function l(t,r){let n=Object.getOwnPropertyDescriptor(t,r);let{set:o}=n||{};return{set(t){let r;r=utils.Function.call(o,this,t);e&&e();return r}}}}registerDependencies(addHooksOnDomAdditions,wrapPropertyAccess);function stripFetchQueryParameter(e,t=null){let r=fetch;if(typeof r!="function")return;let n=t?toRegExp(t):null;window.fetch=(...t)=>{let[o]=t;if(typeof o=="string"&&(!n||n.test(o))){let r=new URL(o);utils.URLSearchParams.delete(r.searchParams,e);t[0]=r.href}return utils.Function.apply(r,this,t)}}registerDependencies(stripFetchQueryParameter,toRegExp);exports["strip-fetch-query-parameter"]=makeInjector(stripFetchQueryParameter);class UndirectedGraph{constructor(e){let t=new Array(e);for(let r=0;r<e;r++)t[r]=new Array(e).fill(0);this.adjacencyMatrix=t}addEdge(e,t){if(e<0||t<0)throw new Error("Can't add an Edge to vertex at negative position ");let r=this.adjacencyMatrix.length;if(e>=r||t>=r)return false;this.adjacencyMatrix[e][t]=1;this.adjacencyMatrix[t][e]=1;return true}}let htmlTags=["a","abbr","address","area","article","aside","audio","b","base","bdi","bdo","blockquote","body","br","button","canvas","caption","cite","code","col","colgroup","data","datalist","dd","del","details","dfn","dialog","div","dl","dt","em","embed","fieldset","figcaption","figure","footer","form","h1","h2","h3","h4","h5","h6","head","header","hgroup","hr","html","i","iframe","img","input","ins","kbd","keygen","label","legend","li","link","main","map","mark","math","menu","menuitem","meta","meter","nav","noscript","object","ol","optgroup","option","output","p","param","picture","pre","progress","q","rb","rp","rt","rtc","ruby","s","samp","script","section","select","slot","small","source","span","strong","style","sub","summary","sup","svg","table","tbody","td","template","textarea","tfoot","th","thead","time","title","tr","track","u","ul","var","video","wbr"];const GRAPH_CUT_OFF=200;const THRESHOLD=.5;let htmlTagsMap=new Map(htmlTags.map(((e,t)=>[e.toUpperCase(),t+1])));function processElement(e){let{mark:t,end:r}=profile("ml:addEdges");let n=new UndirectedGraph(GRAPH_CUT_OFF);let o=1;let i=new Array(GRAPH_CUT_OFF).fill(0);let l=(e,t)=>{let r=e.children;for(let e of r){if(o>GRAPH_CUT_OFF)break;i[o]=htmlTagsMap.get(e.tagName)||0;n.addEdge(t,o);l(e,o++)}};i[0]=htmlTagsMap.get(e.tagName)||0;t();l(e,0);r();let a=n.adjacencyMatrix;return{adjMatrix:a,elementTags:i}}function predictAds(e,t){let r=(debug?log:()=>{}).bind(null,"ml-hide-if-graph-matches");let n=document.querySelectorAll(e);for(let e of n){if(t.has(e))continue;if(e.innerText=="")continue;t.add(e);let n=processElement(e);let{mark:o,end:i}=profile(`ml:inference:${randomId()}`);o();chrome.runtime.sendMessage({type:"ml.inference",inputs:[{data:[n.elementTags],preprocess:[{funcName:"cast",args:"int32"},{funcName:"pad",args:GRAPH_CUT_OFF},{funcName:"oneHot",args:htmlTags.length},{funcName:"cast",args:"float32"}]},{data:[n.adjMatrix],preprocess:[{funcName:"pad",args:GRAPH_CUT_OFF},{funcName:"unstack"},{funcName:"localPooling"},{funcName:"stack"}]}],model:"mlHideIfGraphMatches"},(t=>{i(true);r(t);let n=Object.values(t);if(!n.some((e=>e>0)))throw new Error("ML prediction results are corrupted");let o=n.filter(((e,t)=>t%2==0)).map((e=>e>THRESHOLD));if(!o[0]){r("Detected ad: "+e.innerText);hideElement(e)}}))}}function mlHideIfGraphMatches(e,t){let r=false;let n=new WeakSet;let o=t;let i=t=>{for(let i of t){if(i.target.tagName==o){if(!r){r=true;requestAnimationFrame((()=>{r=false;predictAds(e,n)}))}break}}};new MutationObserver(i).observe(document,{childList:true,characterData:true,subtree:true});predictAds(e,n)}exports["ml-hide-if-graph-matches"]=mlHideIfGraphMatches;function hashImage(e,t){function r(e){e.sort(((e,t)=>e-t));let{length:t}=e;if(t%2===0)return(e[t/2-1]+e[t/2])/2;return e[t/2|0]}function n(e,t){let n=t*256*3/2;let o=e.length/4;for(let t=0;t<4;t++){let i=t*o;let l=(t+1)*o;let a=r(e.slice(i,l));for(let t=i;t<l;t++){let r=e[t];e[t]=r>a||a-r<1&&a>n?1:0}}}function o(e){let t=[];let{length:r}=e;for(let n=0;n<r;n+=4){let r=e.slice(n,n+4);t.push(parseInt(r.join(""),2).toString(16))}return t.join("")}function i(e,t){let{width:r,height:i,data:l}=e;let a=r/t|0;let s=i/t|0;let c=new Array(t*t);for(let e=0;e<t;e++){for(let n=0;n<t;n++){let o=0;for(let t=0;t<s;t++){let i=((e*s+t)*r+n*a)*4;for(let e=0;e<a;e++){let e=l[i+3];if(e===0)o+=765;else o+=l[i]+l[i+1]+l[i+2];i+=4}}c[e*t+n]=o}}n(c,a*s);return o(c)}function l(e,t){let r;let l;let a;let s;let c;let p;let u;let d;let f;let g;let h;let y;let m;let b;let w;let O;let P;let E;let{width:M,height:A,data:S}=e;let D=M%t===0;let x=A%t===0;if(D&&x)return i(e,t);let C=new Array(t*t).fill(0);a=M/t;s=A/t;w=1;b=0;m=s;c=1;p=0;let T=0;for(l=0;l<A;l++){if(x){f=g=l/s|0}else{if(l+1>=m){let e=(l+1)%s;w=e|0;b=e-w;if(s>1)m=Math.ceil((l+1)/s)*s;c=1-b;p=b}if(w>0||l+1===A){f=g=l/s|0}else{let e=l/s;f=e|0;g=f===e?f:f+1}}E=1;P=0;O=a;u=1;d=0;for(r=0;r<M;r++){let e=765;let n=S[T+3];if(n!==0)e=S[T]+S[T+1]+S[T+2];if(D){h=y=r/a|0}else{if(r+1>=O){let e=(r+1)%a;E=e|0;P=e-E;if(a>1)O=Math.ceil((r+1)/a)*a;u=1-P;d=P}if(E>0||r+1===M){h=y=r/a|0}else{let e=r/a;h=e|0;y=h===e?h:h+1}}C[f*t+h]+=e*c*u;C[f*t+y]+=e*c*d;C[g*t+h]+=e*p*u;C[g*t+y]+=e*p*d;T+=4;E++}w++}n(C,a*s);return o(C)}return l(e,t)}function hammingDistance(e,t){let r=[0,1,1,2,1,2,2,3,1,2,2,3,2,3,3,4];let n=0;let o;if(e.length!==t.length)throw new Error("Can't compare hashes with different length");for(o=0;o<e.length;o++){let i=parseInt(e[o],16);let l=parseInt(t[o],16);n+=r[i^l]}return n}function hideIfContainsImageHash(e,t,r,n,o){if(t==null||t==="")t="img";if(r==null)r=0;if(n==null)n=8;if(isNaN(r)||isNaN(n))return;n|=0;if(n<1||n>64)return;o=(o||"").split("x");let i=new Set;let l=l=>{for(let a of l){i.add(a.src);let l=new Image;l.crossOrigin="anonymous";l.onload=()=>{let i=document.createElement("canvas");let s=i.getContext("2d");let{width:c,height:p}=l;let u=parseInt(o[0],10)||0;let d=parseInt(o[1],10)||0;let f=parseInt(o[2],10)||c;let g=parseInt(o[3],10)||p;if(f==0||g==0)return;if(u<0)u=c+u;if(d<0)d=p+d;if(u<0)u=0;if(d<0)d=0;if(f>c)f=c;if(g>p)g=p;i.width=f;i.height=g;s.drawImage(l,u,d,f,g,0,0,f,g);let h=s.getImageData(0,0,f,g);let y=hashImage(h,n);for(let n of e.split(",")){if(y.length==n.length){if(hammingDistance(y,n)<=r){let e=a.closest(t);if(e){hideElement(e);return}}}}};l.src=a.src}};l(document.images);new MutationObserver((()=>{let e=new Set;for(let t of document.images){if(!i.has(t.src))e.add(t)}if(e.size)l(e)})).observe(document,{childList:true,subtree:true,attributes:true})}exports["hide-if-contains-image-hash"]=hideIfContainsImageHash;function hideIfLabelledBy(e,t,r=null){let n=r==null;let o=toRegExp(e);let i=new WeakSet;let l=()=>{for(let e of document.querySelectorAll(t)){let t=n?e:e.closest(r);if(!t||!isVisible(e,getComputedStyle(e),t))continue;let l=e.getAttribute("aria-labelledby");let a=()=>{if(i.has(t))return;if(o.test(e.getAttribute("aria-label")||"")){i.add(t);hideElement(t)}};if(l){for(let e of l.split(/\s+/)){let r=document.getElementById(e);if(r){if(!i.has(r)&&o.test(r.innerText)){i.add(r);hideElement(t)}}else{a()}}}else{a()}}};let a={characterData:true,childList:true,subtree:true};new MutationObserver(l).observe(document,a);l()}exports["hide-if-labelled-by"]=hideIfLabelledBy;function hideIfMatchesXPath(e){let{mark:t,end:r}=profile("hide-if-matches-xpath");let n=new XPathEvaluator;let o=n.createExpression(e,null);let i=XPathResult.ORDERED_NODE_SNAPSHOT_TYPE;let l=()=>{t();let e=o.evaluate(document,i,null);for(let t=0,{snapshotLength:r}=e;t<r;t++){let r=e.snapshotItem(t);if(r.nodeType===Node.ELEMENT_NODE)hideElement(r);else r.textContent=""}r()};let a={characterData:true,childList:true,subtree:true};new MutationObserver(l).observe(document,a);l()}exports["hide-if-matches-xpath"]=hideIfMatchesXPath;let debug=false;function setDebug(){debug=true}exports["debug"]=setDebug;let noopProfile={mark(){},end(){},toString(){return"{mark(){},end(){}}"}};let inactiveProfile=true;function setProfile(){inactiveProfile=false}exports["profile"]=setProfile;function profile(e,t=10){if(inactiveProfile)return noopProfile;function r(){let e=[];for(let{name:t,duration:r}of performance.getEntriesByType("measure"))e.push({name:t,duration:r});if(e.length){performance.clearMeasures();chrome.runtime.sendMessage({type:"profiler.sample",category:"snippets",samples:e})}}if(!profile[e]){profile[e]=setInterval(r,Math.round(6e4/Math.min(60,t)))}return{mark(){performance.mark(e)},end(t=false){performance.measure(e,e);performance.clearMarks(e);if(t){clearInterval(profile[e]);delete profile[e];r()}}}}
//# sourceMappingURL=snippets.min.js.map